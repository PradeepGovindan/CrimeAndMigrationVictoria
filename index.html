<!DOCTYPE html>
<meta charset="utf-8">



<head>
        <title>Migration vs Crime(Victoria)</title>
    
    
<!--  Load Css  -->
    <style type="text/css">
            div.tooltip {
                position: absolute;			
                text-align: center;	
                text-decoration-color: black;
                text-decoration-style: double;
                vertical-align: middle; 
                width: 120px;			
                padding: 2px;	
                font: 12px sans-serif;		
                background: lightyellow;	
                border: 0px;		
                border-radius: 8px;			
                pointer-events: none;			
            }
        .bubbles {
            stroke-width: 1px;
            stroke: black;
            opacity: .8
            }
        .bubbles:hover {
            stroke: black;
            }
    </style>  
    
    
    
</head>
<!-- Load d3.js -->
<!--<script src="https://d3js.org/d3.v4.js"></script>-->
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>


<body style="background-color: #eee6ff" onload="myLoad()">

<div id = "main" style = "text-align:center; top: 0;">
    <p><h1><u>Effects of Migration in Crime(Victoria)<input type="image" src="infobutton.png" alt="Instructions" style="float:right;" width="40" height="40" right="0"onclick="show_info()"></u></h1></p>
    
    
    <div id="info" style="text-align:center; border: 1px solid #dd99ff; display: none" >
        <h3>***Instructions to use***</h3><br>
        Use the arrow buttons to slide between the visulisations.        
        <br><h3>Crime Rate</h3>
        <pre><p style = "text-align:left;">
                                            - The Victoria map shows the visualisation of crime rate in each city of Victoria. <br/>
                                            - Map can be zoomed in and out using pinch operations.<br/>
                                            - Hover the map to highlight the cities.<br/>
                                            - Click the city to look at the have visualisation of different crime types in the particular city in doughnut graph.<br/>
                                            - Change the dropdown value to have visulisation of crime rate different type of crime in Map and Bar graph.<br/>
            
        </p></pre>
        <br/><h3>Migration to Victoria</h3>
        <pre><p style = "text-align:left;">
                                            - The Network map displays nationalities of the migrants.<br/>
                                            - Use the drop down to have visualisation of different years of migration.<br/>
                                            - Click the network link to update the Lolipop chart to show migration of different years from particular country.<br/>
                                            - The below panel shows the Top ten migration countries.<br/>
        </p></pre>
        <br/><h3>Crime Rate vs Migration Rate</h3>
        <pre><p style = "text-align:left;">
                                            - Use the year slider to show data of different years.<br/>
                                            - Hover each bubble in the bubble graph to highlight each city bubble.<br/>
                                            - Click the bubble to update the line graph with migration trend and crime trend of the city<br/>
        </p></pre>
        <button style="border-radius: 5px;" onclick="close_info()">Close</button><pre>    </pre><br/>
        </div>
    </div>

<!--First slide-->
    
    <div id= "first_div" style = "text-align:center; width: 100%; height: 800px;">
        <table style="width:1500px"><tr style="width: :100%">
        <td style="width: 33%; text-align:center;">
            
        </td>
        <td style="width: 34%">
            <h2><u>Crime rates in Victoria</u></h2>
        </td>
        <td style="width: 33%; text-align:center;">
            <input type="image" src="Nexticon.png" alt="Migration" width="40" height="40" onclick="first_next()">
        </td>
            </tr>
        </table>
        <table id = "first_table" style="text-align:center; width: 100%; height: 100%">
            <tr style = "text-align:center; width: 100%; height: 100%">
                <td id = "choro" style="text-align:center; width: 60%; height: 100%; left">
                    <table>
                        <tr style = "height: 5%">
                            <td style="text-align:left; width: 75%; bottom:0">
                                
                            </td>
                            <td style="width: 30%; text-align:center">
                                <select id="c_dropdown" style="height:35px;width: 350px; font-size: 20px; border-radius: 10px;"></select>
                            </td>
                        </tr>
                        <tr style = "height: 95%">
                            <td style="width: 70%;">
                                <svg id="map" style="width: 1000; height:700; text-align:left; border: 1px solid #dd99ff; top:0"></svg>
                            </td>
                            <td id="side_first" style="width: 100%; height: 100%">
                                <table id = "side_first_tab" style="width: 100%; height: 100%">
                                    <tr id="bar_graph" style="width: 100%; height: 45%">
                                        <td>
                                           <svg id="svg_bar" style = "width: 480; height:300; border: 1px solid #dd99ff" ></svg>
                                        </td>
                                    </tr>
                                    <tr id="donut" style="width: 100%; height: 55%">
                                        <td>
                                            <svg id="svg_donut" style = "width: 480; height:400; border: 1px solid #dd99ff" ></svg>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

<!--Second slide-->

    <div id = "second_div" style="text-align:left; width: 100%; height: 800px;">
        <table style="width:1500px"><tr style="width: :100%">
        <td style="width: 33%; text-align:center;">
            <input type="image" src="Previcon.png" alt="Crime" width="40" height="40" onclick="sec_prev()">
        </td>
        <td style="text-align:center; width: 34%">
            <h2><u>Migration to Victoria</u></h2>
        </td>
        <td style="width: 33%; text-align:center;">
            <input type="image" src="Nexticon.png" alt="MigrationVsCrime" width="40" height="40" onclick="sec_next()">
        </td>
            </tr>
        </table>
        <table id = "second_table" style="text-align:center; width: 100%; height: 100%">
            <tr style = "text-align:center; width: 100%; height: 100%">
                <td id = "net" style="text-align:center; width: 70%; height: 100%; left">                    
                    <svg id="svg_netwrok_map" style="text-align:left; left:0;border: 1px solid #dd99ff" width=1000 height=700></svg>
                </td>
                <td id = "net_assist" style="width: 500">
                    <table>
                        <tr style="height:20%;">
                            <td><select id="dropdown" style="height:35px;width: 200px; font-size: 20px;border-radius: 10px;"></select></td>                        
                        </tr>
                        <tr style="height:45%;">
                            <td>
                                <svg id="svg_lol" style = "width: 500; height:380; border: 1px solid #dd99ff" ></svg>
                            </td>
                        </tr>
                        <tr style="height:35%;">
                            <td>
                                Top 5 migration countries<br/>
                                <svg id="svg_top" style = "width: 500; height:270; border: 1px solid #dd99ff"></svg>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
<!--Third slide-->
    <div id = "third_div" style="text-align:left; width: 100%; height: 800px;">
        <table style="width:1500px"><tr style="width: :100%">
        <td style="width: 33%; text-align:center;">
            <input type="image" src="Previcon.png" alt="Migration" width="40" height="40" onclick="third_prev()">
        </td>
        <td style="text-align:center; width: 34%">
            <h2><u>Crime rates vs Migration Rate</u></h2>
        </td>
        <td style="width: 33%; text-align:center;">
            
        </td>
            </tr>
        </table>
        <table id = "third_table" style="text-align:center; width: 100%; height: 100%">
            <tr style = "text-align:center; width: 100%; height: 100%">
                <td id = "bubble" style="text-align:center; width: 70%; height: 100%; left"> 
                    <svg id="slider" style = "height:80" ></svg>
                    <svg id="svg_bub" style="text-align:left; left:0;border: 1px solid #dd99ff" width=1000 height=700></svg>
                </td>
                <td id = "bub_assist" style="width: 500">
                    <table>
                        <tr style="height:50%;">
                            <td>
                                <svg id="svg_line_mig" style = "width: 500; height:400;border: 1px solid #dd99ff" ></svg>
                            </td>
                        </tr>
                        <tr style="height:50%;">
                            <td>
                                <svg id="svg_line_crime" style = "width: 500; height:400;border: 1px solid #dd99ff" ></svg>
                                
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
</div>
</body>
    
      

    
    
    
<!--Load Javascript    -->
    
    
<script> 
//    function to load page
    function myLoad()
    {
        var first_div = document.getElementById("first_div");
        var sec_div=document.getElementById("second_div");
        var third_div=document.getElementById("third_div");
        var info = document.getElementById("info");
        first_div.style.display = "block";
        sec_div.style.display = "none";
        third_div.style.display = "none";
        info.style.display = "none";
    }
//    funtion to change slides
    function first_next()
    {
        var first_div = document.getElementById("first_div");
        var sec_div=document.getElementById("second_div");
          
        first_div.style.display = "none";
        sec_div.style.display = "block";
          
    }
    
    function sec_next()
    {
        var sec_div=document.getElementById("second_div");
        var third_div=document.getElementById("third_div");
        sec_div.style.display = "none";
        third_div.style.display = "block";
    }
    
    function sec_prev()
    {
        var first_div = document.getElementById("first_div");
        var sec_div=document.getElementById("second_div");
        sec_div.style.display = "none";
        first_div.style.display = "block";   
    }
    
    function third_prev()
    {
        var sec_div=document.getElementById("second_div");
        var third_div=document.getElementById("third_div");
        third_div.style.display = "none";
        sec_div.style.display = "block";
        
    }
//funtions to show  and hide intsruction page
    function show_info()
    {
        var info = document.getElementById("info");
        if(info.style.display == "none")
            {
                info.style.display = "block";
            }
        else{
        info.style.display = "none";
        }
    }
    function close_info()
    {
        var info = document.getElementById("info");
        info.style.display = "none";
    }
    
    var choro_year = 2015;
    var choro_type = "All";
    var choro_height = 80;
    var choro_margin = 100;
    var choro_width = 400;
    var x1 = choro_margin;
    var x2 = choro_width - choro_margin-50;
    var dist = (x2-x1)/3;
    var y = choro_height / 2;
    
    var c_margin = {top: 40, right: 20, bottom: 20, left: 80};
        var c_width = 1000 - c_margin.left - c_margin.right;
        var c_height = 700 - c_margin.top - c_margin.bottom;
    
    svg_choro_m = d3.select("#map")
            .attr("width", c_width+ c_margin.left + c_margin.right+50)
                .attr("height", c_height+ c_margin.top + c_margin.bottom+20)
        
    
    
    var mapwidth = 1000;
    var height = 700;
    var filteredColor = "#bbb";
    var palette = "OrRd";
    var div = d3.select("body").append("div")	
                .attr("class", "tooltip")				
                .style("opacity", 0);

//    get SVG element
    var svg_choro = svg_choro_m.append("svg").style("height", height).style("width", mapwidth)
                    .append("g").attr("id", "map-g").style("width", mapwidth).style("left", 0)
                    .call(d3.zoom().on("zoom", function () {
                    svg_choro.attr("transform", d3.event.transform)
                    }))
//     load data file for crime 
    d3.queue()
        .defer(d3.csv, "Crime_data.csv")
        .defer(d3.json, "LGAvic.json")
        .await(ready);
    var projection = d3.geoMercator()
        .center([145, -36])
        .scale(5500);

    var path = d3.geoPath()
      .projection(projection);
    var minValue = Infinity;
    var maxValue = -1;
//   color range value     
    minValue = 40;
    maxValue = 150;
    var value2range = d3.scaleLinear()
                .domain([minValue, maxValue])
                .range([0.5, 1]);
    var range2color = d3.interpolateReds;
    
    
    var color; 

//funtion to load visualisation
    function ready(error, data, geo) {
    
    
    draw_map(data, geo, choro_year); 
    
    crime_dropdown_fun(data, geo, choro_year);
    draw_bar(data, choro_type);
    doughnut_fun(data, region="All");
    draw_net_map();
    draw_bubble();
    
}
//assist funtion to calculate crime data
    function getCrimeRate(cdata, region, cyear = choro_year, type=choro_type)
    {
        var totalRate = 0;
        var number = 0;
        cdata.forEach(function(crimeData){ 
            if(type=="All")
                {
                if(crimeData.Crime_City.toLowerCase()==region.toLowerCase() && crimeData.Crime_Year==cyear)
                    {
                        totalRate = totalRate + Number(crimeData.Crime_Rate);
                        number = number+1;
                    }            
                }
            else
                {
                    if(crimeData.Crime_City.toLowerCase()==region.toLowerCase() && crimeData.Crime_Year==cyear && crimeData.Offence_Division.toLowerCase()==type.toLowerCase())
                    {
                        totalRate = totalRate + Number(crimeData.Crime_Rate);
                        number = number+1;
                    } 
                }
            })
        var res = totalRate/number;
        return res;
    }
//funtion to draw map
    function draw_map(data, geo, year, choro_type)
    {
        d3.select("#map").style("height", 700).style("width", mapwidth);
        svg_choro.append("g").style("height", height)
        .style("width", mapwidth)
        .selectAll("path")
        .data(geo.features)
        .enter().append("path")
                .attr("fill", function(thisElement){
                    var colvalue =  getCrimeRate(data, thisElement.properties.vic_lga__3, choro_year, choro_type);
       
                    var c = range2color(value2range(colvalue));
                    return c;
    })
            .attr("d", d3.geoPath()
                .projection(projection)
            )        
    
            .style("stroke", "#000000")
            .style("stroke-width", function(thisElement){
                                                return 0.25})
            .on("mouseover", function(thisElement) { color = this.style.fill; 
                                  this.style.fill = "#9ACD32"; 
                                 div.transition()		
                                .duration(200)		
                                .style("opacity", .9)
                                .style("font-display","block");
                                div.html(thisElement.properties.vic_lga__3 + " Crime Rate: "+ Math.round(getCrimeRate(data, thisElement.properties.vic_lga__3, choro_year, choro_type)*100)/100)	
                                .style("left", (d3.event.pageX) + "px")		
                                .style("top", (d3.event.pageY - 28) + "px");	})
            .on("mouseout", function(d) { this.style.fill = color; div.transition()		
                            .duration(500)		
                            .style("opacity", 0);	})
            .on("click", function(d){
                d3.select("#svg_donut").select("svg").remove();
                doughnut_fun(data, d.properties.vic_lga__3);
                
            });
//        add legend
        var colorvalues = ["#ffcccc", "#ff8080", "#ff3333", "#e60000", "#990000","#660000"];
        var leg = d3.select("#map").append("svg").style("height", 50).style("width", 200)
                .append("g").style("height", 20)
                .style("width", 120);
        leg.append("rect")
            .attr("x", 655)
            .attr("y", 30)
            .attr("width", 270)
            .attr("height", 55)
            .attr("stroke", "black")
            .attr("fill", "#eee6ff")
        leg.selectAll("legend")
        .data(colorvalues)
            .enter().append("rect")
             .attr("x", function(d,i) { return (i*30)+700; })
              .attr("width", 30)
              .attr("y", 50 )
              .attr("height", 20 )
              .attr("fill", function(d,i) { return d; });
//        add text elements
        var text = leg.append("text")
          .attr('x', 800)
          .attr("y", 45)
          .text("Crime Rate")
        .attr("font-size", "15px")
          .attr("text-anchor", "middle")
        var text = leg.append("text")
          .attr('x', 680)
          .attr("y", 65)
          .text("30")
        .attr("font-size", "15px")
          .attr("text-anchor", "middle")
        var text = leg.append("text")
          .attr('x', 900)
          .attr("y", 65)
          .text("180")
        .attr("font-size", "15px")
          .attr("text-anchor", "middle")
        
    }
    
    
//    funtoin for dropdown function
    function crime_dropdown_fun(data, geo, choro_year)
    {
        crime_list = ["All", "A Crimes against the person", "B Property and deception offences", "C Drug offences", "D Public order and security offences", "E Justice procedures offences", "F Other offences"];
         d3.select("#c_dropdown")
          .selectAll("option")
          .data(crime_list)
          .enter()
          .append("option")
          .attr("value", function(d) { return d })
          .text(function(d) { return d });
        
        var c_dropDown = d3.select("#c_dropdown");

        c_dropDown.on("change", function() {
                    choro_type = d3.select(this).property('value');
                   draw_map(data, geo, choro_year, choro_type); 
            d3.select("#svg_bar").select("svg").remove();
            draw_bar(data, choro_type);
            
                });
    }
    
//    funtion to draw bar graph
    function draw_bar(b_data, choro_type)
    {
        
        var b_margin = {top: 40, right: 20, bottom: 20, left: 80};
        var b_width = 400 - b_margin.left - b_margin.right;
        var b_height = 250 - b_margin.top - b_margin.bottom;

        // set the ranges
        var b_x = d3.scaleBand()
                  .range([0, b_width])
                  .padding(0.1);
        var b_y = d3.scaleLinear()
                  .range([b_height, 0]);
        
        d3.select("#svg_bar")
            .attr("width", b_width+ b_margin.left + b_margin.right+50)
                .attr("height", b_height+ b_margin.top + b_margin.bottom+20)
        var svg_bar = d3.select("#svg_bar").append("svg")
                .attr("width", b_width+ b_margin.left + b_margin.right+50)
                .attr("height", b_height+ b_margin.top + b_margin.bottom+20)
                .append("g")
                .attr("transform", 
                    "translate(" + b_margin.left + "," + b_margin.top + ")");
        var bar_dict={};
        b_data.forEach(function(row){
            if(choro_type=="All")
                {
                    if(isNaN(bar_dict[row.Crime_Year]))
                            {
                                bar_dict[row.Crime_Year] = 0;
                            }
                        bar_dict[row.Crime_Year] = (bar_dict[row.Crime_Year] + Number(row.Crime_Rate))/2;
                }
            else
            {
                if(row.Offence_Division==choro_type)
                    {
                        if(isNaN(bar_dict[row.Crime_Year]))
                            {
                                bar_dict[row.Crime_Year] = 0;
                            }
                        bar_dict[row.Crime_Year] = (bar_dict[row.Crime_Year] + Number(row.Crime_Rate))/2;
                    }
            }
            });
        bar_list = [];
        for( var key in bar_dict){
            var s_dict = {};
            s_dict["Year"] = key;
            s_dict["crime_Rate"] = bar_dict[key];
            bar_list.push(s_dict)
        }
        
        // Scale the range of the data in the domains
          b_x.domain(bar_list.map(function(d) { return d.Year; }));
          b_y.domain([0, d3.max(bar_list, function(d) { return d.crime_Rate; })]);

          // add rectangle
         var bar = svg_bar.selectAll(".bar")
              .data(bar_list)
            .enter().append("rect")
              .attr("class", "bar")
                
             bar.attr("x", function(d) { return b_x(d.Year); })
              .attr("width", b_x.bandwidth())
        
                .transition().duration(1000)
              .attr("y", function(d) { return b_y(d.crime_Rate); })
              .attr("height", function(d) { return b_height - b_y(d.crime_Rate); })
              .attr("fill", "#ff4d4d");
                
        var text = svg_bar.append("text")
          .attr('x', b_width-10)
          .attr("y", b_height+20)
          .text("Year")
        .attr("font-size", "15px")
          .attr("text-anchor", "middle")
        
        var text2 = svg_bar.append("text")
          .attr('x', b_width-300)
          .attr("y", 0)
          .text("Crime Rate")
        .attr("font-size", "15px")
          .attr("text-anchor", "middle")
        
        var text2 = svg_bar.append("text")
          .attr('x', b_width-150)
          .attr("y", b_height+38)
          .text("Crime Rate for "+choro_type)
        .attr("font-size", "15px")
          .attr("text-anchor", "middle")
            
            
          // add axis
          svg_bar.append("g")
              .attr("transform", "translate(0," + b_height + ")")
              .call(d3.axisBottom(b_x));

          svg_bar.append("g")
              .call(d3.axisLeft(b_y));
    }
//    funtion to draw donut chart
    function doughnut_fun(d_data, region)
    {
       
        
            
            // set the dimensions and margins of the graph
            var width = 450
                height = 400
                margin = 40
        
            d3.select("#svg_donut")
            .attr("width", width)
                .attr("height", height)
            // The radius of the pieplot is half the width or half the height (smallest one). I substract a bit of margin.
            var radius = Math.min(width, height) / 2 - margin

            // append the svg object'
            var svg_dn = d3.select("#svg_donut")
              .append("svg")
                .attr("width", width)
                .attr("height", height)
              .append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

            // create data
            var bar_dict={};
        d_data.forEach(function(row){
            if(region=="All")
                {
                    if(isNaN(bar_dict[row.Offence_Division[0]]))
                            {
                                bar_dict[row.Offence_Division[0]] = 0;
                            }
                        bar_dict[row.Offence_Division[0]] = (bar_dict[row.Offence_Division[0]] + Math.round(Number(row.Crime_Rate)*100)/100)/2;
                }
            else
            {
                if(row.Crime_City.toLowerCase()==region.toLowerCase())
                    {
                        if(isNaN(bar_dict[row.Offence_Division[0]]))
                            {
                                bar_dict[row.Offence_Division[0]] = 0;
                            }
                        bar_dict[row.Offence_Division[0]] = (bar_dict[row.Offence_Division[0]] + Math.round(Number(row.Crime_Rate)*100)/100)/2;
                    }
            }
            });
         key_list =[];
             for( var key in bar_dict){            
                key_list.push(key)
            }
            // set the color scale
            var color = d3.scaleOrdinal()
              .domain(key_list)
              .range(d3.schemeDark2);

            
            var pie = d3.pie()
              .sort(null) // Do not sort group by size
              .value(function(d) {return d.value; })
            var data_ready = pie(d3.entries(bar_dict))

            
            var arc = d3.arc()
              .innerRadius(radius * 0.5)         
              .outerRadius(radius * 0.7)

            
            var outerArc = d3.arc()
              .innerRadius(radius * 0.9)
              .outerRadius(radius * 0.9)
            
            // add circles
            svg_dn
              .selectAll('allSlices')
              .data(data_ready)
              .enter()
              .append('path')
              .attr('d', arc)
            .transition().duration(1000)
              .attr('fill', function(d){ return(color(d.data.key)) })
              .attr("stroke", "white")
              .style("stroke-width", "2px")
              .style("opacity", 0.7)

            // add lines for labels
            svg_dn
              .selectAll('allPolylines')
              .data(data_ready)
              .enter()
              .append('polyline')
                .attr("stroke", "black")
                .style("fill", "none")
                .attr("stroke-width", 1)
                .attr('points', function(d) {
                  var posA = arc.centroid(d) // line insertion in the slice
                  var posB = outerArc.centroid(d) // line break: we use the other arc generator that has been built only for that
                  var posC = outerArc.centroid(d); // Label position = almost the same as posB
                  var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2 // we need the angle to see if the X position will be at the extreme right or extreme left
                  posC[0] = radius * 0.95 * (midangle < Math.PI ? 1 : -1); // multiply by 1 or -1 to put it on the right or on the left
                  return [posA, posB, posC]
                })

            // add labels
            svg_dn
              .selectAll('allLabels')
              .data(data_ready)
              .enter()
              .append('text')
                .text( function(d) { return (d.data.key+"-"+(Math.round(d.value*100)/100))})
                .attr('transform', function(d) {
                    var pos = outerArc.centroid(d);
                    var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2
                    pos[0] = radius * 0.99 * (midangle < Math.PI ? 1 : -1);
                    return 'translate(' + pos + ')';
                })
                .style('text-anchor', function(d) {
                    var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2
                    return (midangle < Math.PI ? 'start' : 'end')
                })
//        add legend text
        svg_dn.append("text")
          .attr('x', 0)
          .attr("y", 170)
          .text("A - Crimes against the person, B - Property and deception offences, C - Drug offences,")
        .attr("font-size", "12px")
          .attr("text-anchor", "middle")
        svg_dn.append("text")
          .attr('x', 0)
          .attr("y", 184)
          .text("D - Property and deception offences, E - Justice procedures offences, F - Other offences")
        .attr("font-size", "12px")
          .attr("text-anchor", "middle")
        svg_dn.append("text")
          .attr('x', 0)
          .attr("y", -180)
          .text("Different Crimes in "+region+" City")
        .attr("font-size", "16px")
          .attr("text-anchor", "middle")
    }
    
    
    
    
//    funtion to draw network map
    function draw_net_map()
    {
                var svg_net = d3.select("#svg_netwrok_map"),
                width = 1500,
                height = 700;

            // define projection
            var projection_net = d3.geoMercator()
                .rotate([-140, 0])
                .translate([width/3, height/2*1.1])
                .scale(150);


            // generate path
            var path = d3.geoPath()
                .projection(projection_net)

            // Load world shape AND migration data
            d3.queue()
            .defer(d3.json, "world.geojson.json")  // World shape
              .defer(d3.csv, "Network_data.csv") // Position of circles
              .await(ready);
             var year_select = ['All Time', '2015','2016','2017','2018']
             var colors = ["#2b8cbe", "#f03b20", "#31a354", "#dd1c77", "#d95f0e"]
             d3.select("#dropdown")
                      .selectAll("option")
                      .data(year_select)
                      .enter()
                      .append("option")
                      .attr("value", function(d) { return d })
                      .text(function(d) { return d });


            function ready(error, dataGeo, data) {

                // Reformat the loaded migration data
               var link = [];
                
                data.forEach(function(row){

                  source = [+row.Longitude, +row.latitude]
                  target = [+row.DestLong, +row.DestLat]
                    avg = (Math.round(row.pct_2015*100)/100+Math.round(row.pct_2016*100)/100+Math.round(row.pct_2017*100)/100+Math.round(row.pct_2018*100)/100)/4
                  migration_pct = [Math.round(avg*100)/100, Math.round(row.pct_2015*100)/100, Math.round(row.pct_2016*100)/100, Math.round(row.pct_2017*100)/100, Math.round(row.pct_2018*100)/100]

                  topush = {type: "LineString", coordinates: [source, target], country:row.Country, mig_data:migration_pct}
                  link.push(topush)
                });
                // Draw the map
                svg_net.append("g")
                    .selectAll("path")
                    .data(dataGeo.features)
                    .enter().append("path")
                        .attr("fill", "#ccccb3")
                        .attr("d", d3.geoPath()
                            .projection(projection_net)
                        )
                        .style("stroke", "#fff")
                        .style("stroke-width", 0)
                update(data, link, 0);
                draw_lol(data, region="All");
                draw_top(data);
                var dropDown = d3.select("#dropdown");

               dropDown.on("change", function() {
                                var year = d3.select(this).property('value');
                    svg_net.selectAll("path")
                            .style("fill", "none")
                            .style("stroke", "none")
                    .style("stroke-width", "none")
                               svg_net.append("g")
                    .selectAll("path")
                    .data(dataGeo.features)
                    .enter().append("path")
                        .attr("fill", "#ccccb3")
                        .attr("d", d3.geoPath()
                            .projection(projection_net)
                        )
                        .style("stroke", "#fff")
                        .style("stroke-width", 0)
                               update(data, link, year_select.indexOf(year));
                            });

            }
//        funtion to update map links
             function update(data, link, selected_ind)
                {


                // add link lines
                svg_net.selectAll("myPath")
                  .data(link)
                  .enter()
                  .append("path")
                    .attr("d", function(d){ return path(d)})
                    .style("fill", "none")
                    .style("stroke", colors[selected_ind])
                    .style("stroke-width", function(thisElement, index)
                          {
                    //return thisElement.mig_data[selected_ind];
                    return 1

                })
                    .on("mouseover", function(thisElement, index){
                                    d3.select(this) // hightlight the on hovering on
                                    .style("stroke", "#ff0000")
                                    .style("stroke-width", 5)
                                    div.transition()		
                                        .duration(200)		
                                        .style("opacity", 1);		
                                     div.html("<b>" + thisElement.country+"</b></br> "+thisElement.mig_data[selected_ind]+"%")
                                    .style("left", (d3.event.pageX) + "px")		
                                    .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function(thisElement, index){ 
                                d3.select(this) // hightlight the on hovering on
                                    .style("stroke", colors[selected_ind])
                                    .style("stroke-width", function(thisElement, index)
                                                            {
                                                                //return thisElement.mig_data[selected_ind];
                                                                return 1;

                                        })
                                div.transition()		
                                        .duration(500)		
                                        .style("opacity", 0);	
                })
                    .on("click", function(thisElement){
                    d3.select("#svg_lol").select("svg").remove();
                    draw_lol(data, thisElement.country);
                    
                })

            }
//        funtion to draw lollipop chart
        function draw_lol(l_data, region)
        {
            
                var margin = {top: 50, right: 30, bottom: 90, left: 70},
                width = 460 - margin.left - margin.right,
                height = 380 - margin.top - margin.bottom;

            var svg_lol = d3.select("#svg_lol")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            //add svg element
            var svg_lol = d3.select("#svg_lol")
              .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
              .append("g")
                .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");

            
            var lol_dict={};
            lol_dict["2015"] = 0;
            lol_dict["2016"] = 0;
            lol_dict["2017"] = 0;
            lol_dict["2018"] = 0;
            l_data.forEach(function(row){
            if(region=="All")
                { 
                    lol_dict["2015"] = lol_dict["2015"]+Number(row.pct_2015);
                    lol_dict["2016"] = lol_dict["2016"]+Number(row.pct_2016);
                    lol_dict["2017"] = lol_dict["2017"]+Number(row.pct_2017);
                    lol_dict["2018"] = lol_dict["2018"]+Number(row.pct_2018);                          
                }
            else
            {
                if(row.Country.toLowerCase()==region.toLowerCase())
                    {
                        lol_dict["2015"] = Number(row.pct_2015);
                        lol_dict["2016"] = Number(row.pct_2016);
                        lol_dict["2017"] = Number(row.pct_2017);
                        lol_dict["2018"] = Number(row.pct_2018);
                    }
            }
            });
             lol_list = [];
        for( var key in lol_dict){
            var s_dict = {};
            s_dict["Year"] = key;
            s_dict["mig_Rate"] = Math.round(lol_dict[key]*100)/100;
            lol_list.push(s_dict)
        }
            
            
            
            //draw axis
            var x = d3.scaleBand()
              .range([ 0, width ])
              .domain(lol_list.map(function(d) { return d.Year; }))
              .padding(1);
            svg_lol.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x))
              .selectAll("text")
                .attr("transform", "translate(+10,0)rotate(-0)")
                .style("text-anchor", "end")
                .style("font-size", 10);
            
            
            var y = d3.scaleLinear()
              .domain([0, d3.max(lol_list, function(d) { return d.mig_Rate; })])
              .range([ height, 0]);
            svg_lol.append("g")
              .call(d3.axisLeft(y));

//            draw lines
            svg_lol.selectAll("myline")
              .data(lol_list)
              .enter()
              .append("line")
                
                
                .attr("y1", function(d) { return y(d.mig_Rate); })
                .attr("y2", y(0))
                .transition().duration(1000)
            .attr("x1", function(d) { return x(d.Year); })
                .attr("x2", function(d) { return x(d.Year); })
                
                .attr("stroke", "grey")

//            draw circles
            svg_lol.selectAll("mycircle")
              .data(lol_list)
              .enter()
              .append("circle")
                .transition().duration(1000)
                .attr("cx", function(d) { return x(d.Year); })
                .attr("cy", function(d) { return y(d.mig_Rate); })
                .attr("r", "8")
                .style("fill", function(d){
                            return colors[year_select.indexOf(d.Year)];                        
                            })
                .attr("stroke", "black")
            var text = svg_lol.append("text")
          .attr('x', width-10)
          .attr("y", height+20)
          .text("Year")
        .attr("font-size", "13px")
          .attr("text-anchor", "middle")
//        add axis names
        var text2 = svg_lol.append("text")
          .attr('x', width-350)
          .attr("y", -5)
          .text("Migration Rate")
        .attr("font-size", "13px")
          .attr("text-anchor", "middle")
        
        var text2 = svg_lol.append("text")
          .attr('x', width-180)
          .attr("y", height+38)
          .text("Migration from "+region)
        .attr("font-size", "17px")
          .attr("text-anchor", "middle")
    
        
        }
//        funtion to show top countries
        function draw_top(t_data)
        {
            var margin = {top: 0, right: 50, bottom: 60, left: 40},
    width = 480 - margin.left - margin.right,
    height = 270 - margin.top - margin.bottom;
            
            var svg_top = d3.select("#svg_top")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);
            
            var svg_top = d3.select("#svg_top")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform",
                  "translate(" + margin.left + "," + margin.top + ")");
            col = ["#a880ff", "#ccb3ff"];
             top_country = [];
            y=10;
            t_data.forEach(function(row){              
                top_country.push(row.Country);
            })
            
            top_country = top_country.slice(0,10);  
            top_ls = []
            for(val in top_country)
                {
                    s ={}
                    s["country"] = top_country[val];
                    y= y+25;
                    s["y"] = y;
                    top_ls.push(s);
                }
            
//          draw background rectangles  
        svg_top.selectAll("rect")
            .data(top_ls)
            .enter()
            .append("rect")
            .attr("x", 100)
            .attr("y", function(d) { return d.y-23;  })
            .attr("width", function(d) { return 200; })
            .attr("height", function(d) { return 21; })
            .style("fill", function(d, i) {return col[i%2]});
//            add text
            svg_top.selectAll('text')
            .data(top_ls)
            .enter()
            .append("text")
            .attr("x", 200)
            .attr("y", function(thisElement){
                return thisElement.y-10;}
                 )
            .attr("text-anchor", "middle")
            .text(function(thisElement, index){
                return (index+1)+"."+thisElement.country;
            })
            .style("font-size", "13px") 
        }

    }
    
    
//    funtion for third slide
    function draw_bubble()
    {
        //load the data
        d3.csv("mig_crime.csv", function(data) {
            draw_bub(data, "2016");
            slider_fun(data);
          })
//       funtion to draw bubble chart 
    function draw_bub(b_data, b_year)
        {
            var margin = {top: 40, right: 50, bottom: 60, left: 40},
    width = 1000 - margin.left - margin.right,
    height = 700 - margin.top - margin.bottom;

            // add svg element
        var svg_bub = d3.select("#svg_bub")
          .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform",
                  "translate(" + margin.left + "," + margin.top + ")");
            
                data_ls = []
                city_ls = []
        b_data.forEach(function(row)
        {
            if(Number(row.Year)==(b_year))
                {
                    b_dict={}
                    b_dict["Population"]=Number(row.Population);
                    b_dict["Migration"]=Number(row.Migration);
                    b_dict["City"]=row.Crime_City;
                    b_dict["Crime"]=Number(row.Crime_Rate);
                    data_ls.push(b_dict);
                    city_ls.push(b_dict["City"]);
                }
        })

      // Add axis
      var x = d3.scaleLinear()
        .domain([0, 350000])
        .range([ 0, width ]);

      svg_bub.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).ticks(5));

      svg_bub.append("text")
          .attr("text-anchor", "end")
          .attr("x", width)
          .attr("y", height+50 )
          .text("Population");

      var y_b = d3.scaleLinear()
        .domain([0, 450])
        .range([ height, 0]);
      svg_bub.append("g")
        .call(d3.axisLeft(y_b));

      svg_bub.append("text")
          .attr("text-anchor", "end")
          .attr("x", 0)
          .attr("y", -20 )
          .text("Total Crime per 100,000")
          .attr("text-anchor", "start")

      
      var z = d3.scaleSqrt()
        .domain([0, 7000])
        .range([ 2, 30]);
      
      var myColor = d3.scaleOrdinal()
        .domain(city_ls)
        .range(d3.schemeCategory10);


     
      var tooltip = d3.select("#svg_bub")
        .append("div")
          .style("opacity", 0)
          .attr("class", "tooltip")
          .style("background-color", "black")
          .style("border-radius", "5px")
          .style("padding", "10px")
          .style("color", "white")

      var showTooltip = function(d) {
        tooltip
          .transition()
          .duration(200)
        tooltip
          .style("opacity", 1)
          .html("Country: " + d.country)
          .style("left", (d3.mouse(this)[0]+30) + "px")
          .style("top", (d3.mouse(this)[1]+30) + "px")
      }
      var moveTooltip = function(d) {
        tooltip
          .style("left", (d3.mouse(this)[0]+30) + "px")
          .style("top", (d3.mouse(this)[1]+30) + "px")
      }
      var hideTooltip = function(d) {
        tooltip
          .transition()
          .duration(200)
          .style("opacity", 0)
      }

    var op;

      // Add bubbles
      svg_bub.append('g')
        .selectAll("dot")
        .data(data_ls)
        .enter()
        .append("circle")
          .attr("class", function(d) { return "bubbles "})
          .attr("cx", function (d) { return x(d.Population); } )
          .attr("cy", function (d) { return y_b(d.Crime); } )
          .attr("r", function (d) { return z(d.Migration); } )
          .style("fill", function (d) { return myColor(d.City); } )
                .style("stroke", "black")
        // -3- Trigger the functions for hover
        .on("mouseover", function(d){ op=this.style.opacity;
        // reduce opacity of all groups
        d3.selectAll(".bubbles").style("opacity", .2);
        // expect the one that is hovered
        d3.select(this).style("opacity", 1);
                                    div.transition()		
                                .duration(200)		
                                .style("opacity", .9)
                                .style("font-display","block");
                                div.html(d.City)	
                                .style("left", (d3.event.pageX) + "px")		
                                .style("top", (d3.event.pageY - 28) + "px");})
        .on("mouseleave", function(d){
        d3.selectAll(".bubbles").style("opacity", op);
          div.transition()		
                                        .duration(500)		
                                        .style("opacity", 0);	
      })
            .on("click", function(d)
            {
                d3.select("#svg_line_mig").select("svg").remove();
                d3.select("#svg_line_crime").select("svg").remove();
                draw_line(b_data, d.City);
          
                
            })
                

        // Add  legends circles
        var valuesToShow = [100, 2000, 6000]
        var xCircle = 790
        var xLabel = 840
        svg_bub
          .selectAll("legend")
          .data(valuesToShow)
          .enter()
          .append("circle")
            .attr("cx", xCircle)
            .attr("cy", function(d){ return height-450 - z(d) } )
            .attr("r", function(d){ return z(d) })
            .style("fill", "none")
            .attr("stroke", "black")

//        add legen lines
        svg_bub
          .selectAll("legend")
          .data(valuesToShow)
          .enter()
          .append("line")
            .attr('x1', function(d){ return xCircle + z(d) } )
            .attr('x2', xLabel+15)
            .attr('y1', function(d){ return height - 450 - z(d) } )
            .attr('y2', function(d){ return height - 450 - z(d) } )
            .attr('stroke', 'black')
            .style('stroke-dasharray', ('2,2'))

//        add legend labels
        svg_bub
          .selectAll("legend")
          .data(valuesToShow)
          .enter()
          .append("text")
            .attr('x', xLabel+17)
            .attr('y', function(d){ return height - 450 - z(d) } )
            .text( function(d){ return d } )
            .style("font-size", 10)
            .attr('alignment-baseline', 'middle')

        // add legend title
        svg_bub.append("text")
          .attr('x', xCircle)
          .attr("y", height - 450 +30)
          .text("Migration")
          .attr("text-anchor", "middle")

        
            d3.select("#svg_line_mig").select("svg").remove();
                d3.select("#svg_line_crime").select("svg").remove();
            draw_line(b_data, "All");
        }
//        funtion to implement slider
        function slider_fun(data)
    {
        var bub_year;
        var drag = d3.drag()
          .on("drag", dragmove); 
        var width = 450
                height = 80
                margin = 40
        
            d3.select("#slider")
            .attr("width", width)
                .attr("height", height)
        var svg_slider = d3.select("#slider").append("svg")
          .attr("width", choro_width+50)
          .attr("height", choro_height)
          .datum({
            x: choro_width / 2,
            y: choro_height / 3
          });
//draw slider line
        var line = svg_slider.append("line")
          .attr("x1", x1)
          .attr("x2", x2)
          .attr("y1", function(d) { return d.y; })
          .attr("y2", function(d) { return d.y; })
          .style("stroke", "black")
          .style("stroke-linecap", "round")
          .style("stroke-width", 3);
        //add slider legends
        var text1 = svg_slider.append("text")
          .attr('x', x1)
          .attr("y", function(d) { return d.y+15; })
          .text("2015")
            .attr("font-size", "10px")
          .attr("text-anchor", "middle")
        var text2 = svg_slider.append("text")
          .attr('x', x1+dist)
          .attr("y", function(d) { return d.y+15; })
          .text("2016")
        .attr("font-size", "10px")
          .attr("text-anchor", "middle")
        var text3 = svg_slider.append("text")
          .attr('x', x2-dist)
          .attr("y", function(d) { return d.y+15; })
          .text("2017")
            .attr("font-size", "10px")
          .attr("text-anchor", "middle")
        var text4 = svg_slider.append("text")
          .attr('x', x2)
          .attr("y", function(d) { return d.y+15; })
          .text("2018")
        .attr("font-size", "10px")
          .attr("text-anchor", "middle")
        
        var text5 = svg_slider.append("text")
          .attr('x', x2-(dist+dist/2))
          .attr("y", function(d) { return d.y-15; })
          .text("Year")
        .attr("font-size", "15px")
          .attr("text-anchor", "middle")
//add slider circle
        var circle = svg_slider.append("circle")
          .attr("r", 10)
          .attr("cy", function(d) { return d.y; })
          .attr("cx", function(d) { return d.x; })
          .style("cursor", "ew-resize")
          .call(drag);
//        funtion to impent drag functionalities
            function dragmove(d) {

          
          var x = d3.event.x;

          x = x < x1 ? x1 : x > x2 ? x2 : x;

            //get x value
          d.x = x;
          if(d.x >=x1 && d.x < x1+(dist/2)){bub_year = 2015;}
          if(d.x >= x1+(dist/2) && d.x < x1+(dist+dist/2)){bub_year = 2016;}
          if(d.x >= x1+(dist+dist/2) && d.x < x1+(2*dist+dist/2)){bub_year = 2017;}
          if(d.x >= x1+(2*dist+dist/2)){bub_year = 2018}

          // Update the slider location.
          circle.attr("cx", x);
                d3.select("#svg_bub").select("svg").remove();
                draw_bub(data, bub_year);  
        }
    }
//        funtion to draw line graphs
    function draw_line(ln_data, region)
        {
//        cretae data for line graphs
           var data_ls=[];
            if(region=="All")
                {
                    b_dict_15={};b_dict_15["Migration"] = 0;b_dict_15["Year"] = 0;b_dict_15["Crime"] = 0;
                    b_dict_16 = {};b_dict_16["Migration"] = 0;b_dict_16["Year"] = 0;b_dict_16["Crime"] = 0;
                    b_dict_17={};b_dict_17["Migration"] = 0;b_dict_17["Year"] = 0;b_dict_17["Crime"] = 0;
                    b_dict_18={};b_dict_18["Migration"] = 0;b_dict_18["Year"] = 0;b_dict_18["Crime"] = 0;
                    
                    
                ln_data.forEach(function(row)
                    { 
                    if(row.Year=="2015")
                        {
                        b_dict_15["Migration"]=b_dict_15["Migration"]+Number(row.Migration)/2;
                        b_dict_15["Year"]=row.Year
                        b_dict_15["Crime"]=b_dict_15["Crime"]+Number(row.Crime_Rate)/2; 
                        }
                    if(row.Year=="2016")
                        {
                        b_dict_16["Migration"]=b_dict_16["Migration"]+Number(row.Migration);
                        b_dict_16["Year"]=row.Year
                        b_dict_16["Crime"]=b_dict_16["Crime"]+Number(row.Crime_Rate)/2; 
                        }
                    if(row.Year=="2017")
                        {
                        b_dict_17["Migration"]=b_dict_17["Migration"]+Number(row.Migration)/2;
                        b_dict_17["Year"]=row.Year
                        b_dict_17["Crime"]=b_dict_17["Crime"]+Number(row.Crime_Rate)/2; 
                        }
                    if(row.Year=="2018")
                        {
                        b_dict_18["Migration"]=b_dict_18["Migration"]+Number(row.Migration)/2;
                        b_dict_18["Year"]=row.Year
                        b_dict_18["Crime"]=b_dict_18["Crime"]+Number(row.Crime_Rate)/2; 
                        }
                });
                                data_ls.push(b_dict_15);data_ls.push(b_dict_16);data_ls.push(b_dict_17);data_ls.push(b_dict_18);
                    
                     }
         else{
             ln_data.forEach(function(row)
                             {
                    if(row.Crime_City==(region))
                        {
                            b_dict={}
                            b_dict["Migration"]=Number(row.Migration);
                            b_dict["Year"]=row.Year
                            b_dict["Crime"]=Number(row.Crime_Rate);
                            data_ls.push(b_dict);
                        }
             });
             
             
         }
            console.log(data_ls);
            draw_line_mig(data_ls, region);
            draw_line_crime(data_ls, region);
                
        }
        //funtion to draw migration line graph
        function draw_line_mig(ln_mig_data, region)
        {
            
            var margin = {top: 20, right: 50, bottom: 50, left: 50},
            width = 460 - margin.left - margin.right,
            height = 350 - margin.top - margin.bottom;
            d3.select("#svg_line_mig")
            .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            // add the svg element
            var svg_ln_mig = d3.select("#svg_line_mig")
            
              .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
              .append("g")
                .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");
            
    

    // Add axis
    var x = d3.scaleBand()
      .domain(ln_mig_data.map(function(d) { return d.Year; }))
      .range([ 0, width ]);
    svg_ln_mig.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

    
    var y = d3.scaleLinear()
      .domain( [d3.min(ln_mig_data, function(d) { return d.Migration; })/2,d3.max(ln_mig_data, function(d) { return d.Migration; })])
      .range([ height, 0 ]);
    svg_ln_mig.append("g")
      .call(d3.axisLeft(y));
 // draw connection lines
    var line = svg_ln_mig
      .append('g')
      .append("path")
        .datum(ln_mig_data)
        .transition()
          .duration(1000)
        .attr("d", d3.line()
          .x(function(d) { return x(d.Year)+50 })
          .y(function(d) { return y(d.Migration) })
        )
        .attr("stroke", "black")
        .style("stroke-width", 4)
        .style("fill", "none")

    // draw dots
    var dot = svg_ln_mig
      .selectAll('circle')
      .data(ln_mig_data)
      .enter()
      .append('circle')
    .transition()
        .duration(1000)
        .attr("cx", function(d) { return x(d.Year)+50 })
        .attr("cy", function(d) { return y(d.Migration) })
        .attr("r", 7)
        .style("fill", "#69b3a2")
    // add text elements
    var text = svg_ln_mig.append("text")
          .attr('x', width-10)
          .attr("y", height+20)
          .text("Year")
        .attr("font-size", "13px")
          .attr("text-anchor", "middle")
        
        var text2 = svg_ln_mig.append("text")
          .attr('x', width-350)
          .attr("y", -2)
          .text("Migration Rate")
        .attr("font-size", "13px")
          .attr("text-anchor", "middle")
        
        var text2 = svg_ln_mig.append("text")
          .attr('x', width-180)
          .attr("y", height+38)
          .text("Migration trend for "+region+" city")
        .attr("font-size", "17px")
          .attr("text-anchor", "middle")
    }
//        funtion to draw crime line graph
        function draw_line_crime(ln_crime_data, region)
        {
            
            var margin = {top: 20, right: 50, bottom: 50, left: 50},
            width = 460 - margin.left - margin.right,
            height = 350 - margin.top - margin.bottom;
            d3.select("#svg_line_crime")
            .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            // append the svg object to the body of the page
            var svg_ln_cr = d3.select("#svg_line_crime")            
              .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
              .append("g")
                .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");
            
   //axis
    var x = d3.scaleBand()
      .domain(ln_crime_data.map(function(d) { return d.Year; }))
      .range([ 0, width ]);
    svg_ln_cr.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

    var y = d3.scaleLinear()
      .domain( [d3.min(ln_crime_data, function(d) { return d.Crime; })/1.2,d3.max(ln_crime_data, function(d) { return d.Crime; })])
      .range([ height, 0 ]);
    svg_ln_cr.append("g")
      .call(d3.axisLeft(y));
 // add lines
    var line = svg_ln_cr
      .append('g')
      .append("path")
        .datum(ln_crime_data)
        .transition()
          .duration(1000)
        .attr("d", d3.line()
          .x(function(d) { return x(d.Year)+50 })
          .y(function(d) { return y(d.Crime) })
        )
        .attr("stroke", "black")
        .style("stroke-width", 4)
        .style("fill", "none")

    // add dots
    var dot = svg_ln_cr
      .selectAll('circle')
      .data(ln_crime_data)
      .enter()
      .append('circle')
    .transition()
        .duration(1000)
        .attr("cx", function(d) { return x(d.Year)+50 })
        .attr("cy", function(d) { return y(d.Crime) })
        .attr("r", 7)
        .style("fill", "#ff0000")
    //add text elements
    var text = svg_ln_cr.append("text")
          .attr('x', width-10)
          .attr("y", height+20)
          .text("Year")
        .attr("font-size", "13px")
          .attr("text-anchor", "middle")
        
        var text2 = svg_ln_cr.append("text")
          .attr('x', width-350)
          .attr("y", -2)
          .text("Crime Rate")
        .attr("font-size", "13px")
          .attr("text-anchor", "middle")
        
        var text2 = svg_ln_cr.append("text")
          .attr('x', width-180)
          .attr("y", height+38)
          .text("Crime trend for "+region+" city")
        .attr("font-size", "17px")
          .attr("text-anchor", "middle")
    }
           

        
    }
    

       
    </script>
    